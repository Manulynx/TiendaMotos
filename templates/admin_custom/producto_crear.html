{% extends 'admin_custom/base.html' %} {% block title %}Crear Producto{%
endblock %} {% block page_title %}Crear Nuevo Producto{% endblock %} {% block
page_subtitle %}Agregar al inventario{% endblock %} {% block content %}
<form id="producto-form" class="max-w-4xl mx-auto">
  {% csrf_token %}

  <div class="bg-white rounded-xl shadow-sm p-4 md:p-8 border border-gray-100">
    <div class="space-y-4 md:space-y-6">
      <!-- Nombre -->
      <div>
        <label class="block text-xs md:text-sm font-medium text-gray-700 mb-2"
          >Nombre del Producto *</label
        >
        <input
          type="text"
          name="nombre"
          required
          class="w-full px-3 md:px-4 py-2.5 md:py-3 text-sm md:text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-accent focus:border-transparent transition-all"
          placeholder="Ej: Honda CBR 600RR"
        />
      </div>

      <!-- Categoría y Precio -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
        <div>
          <label class="block text-xs md:text-sm font-medium text-gray-700 mb-2"
            >Categoría *</label
          >
          <select
            name="categoria"
            required
            class="w-full px-3 md:px-4 py-2.5 md:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-accent focus:border-transparent transition-all"
          >
            <option value="">Seleccionar...</option>
            {% for cat in categorias %}
            <option value="{{ cat.id }}">{{ cat.nombre }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="grid grid-cols-3 gap-2 md:gap-3">
          <div class="col-span-2">
            <label
              class="block text-xs md:text-sm font-medium text-gray-700 mb-2"
              >Precio *</label
            >
            <input
              type="number"
              step="0.01"
              name="precio"
              required
              class="w-full px-3 md:px-4 py-2.5 md:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-accent focus:border-transparent transition-all"
            />
          </div>

          <div>
            <label
              class="block text-xs md:text-sm font-medium text-gray-700 mb-2"
              >Moneda</label
            >
            <select
              name="moneda"
              class="w-full px-2 md:px-4 py-2.5 md:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-accent focus:border-transparent transition-all"
            >
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="CUP">CUP</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Stock -->
      <div>
        <label class="block text-xs md:text-sm font-medium text-gray-700 mb-2"
          >Stock Inicial</label
        >
        <input
          type="number"
          name="stock"
          value="0"
          class="w-full px-3 md:px-4 py-2.5 md:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-accent focus:border-transparent transition-all"
        />
      </div>

      <!-- Descripción -->
      <div>
        <label class="block text-xs md:text-sm font-medium text-gray-700 mb-2"
          >Descripción</label
        >
        <textarea
          name="descripcion"
          rows="5"
          class="w-full px-3 md:px-4 py-2.5 md:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-accent focus:border-transparent transition-all"
          placeholder="Describe las características del producto..."
        ></textarea>
      </div>

      <!-- Imagen -->
      <div>
        <label class="block text-xs md:text-sm font-medium text-gray-700 mb-3"
          >Imagen Principal</label
        >
        <div
          class="border-2 border-dashed border-gray-300 rounded-xl p-6 md:p-8 text-center hover:border-red-accent transition-colors cursor-pointer"
          onclick="document.getElementById('imagen-input').click()"
        >
          <div id="preview-container">
            <svg
              class="w-12 h-12 md:w-16 md:h-16 mx-auto mb-2 md:mb-3 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
            <p class="text-sm md:text-base text-gray-600 font-medium mb-1">
              Click para subir imagen
            </p>
            <p class="text-xs md:text-sm text-gray-400">PNG, JPG hasta 5MB</p>
          </div>
        </div>
        <input
          type="file"
          id="imagen-input"
          name="imagen"
          accept="image/*"
          class="hidden"
          onchange="previewImagen(event)"
        />
      </div>
    </div>
  </div>

  <!-- Botones Sticky -->
  <div
    class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-30 md:left-64"
  >
    <div class="max-w-4xl mx-auto px-4 md:px-8 py-3 md:py-4">
      <div class="flex flex-col sm:flex-row gap-2 md:gap-4">
        <button
          type="submit"
          class="flex-1 px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base bg-gradient-to-r from-red-accent to-red-600 text-white rounded-xl hover:shadow-xl transition-all font-bold flex items-center justify-center gap-2"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 13l4 4L19 7"
            />
          </svg>
          Crear Producto
        </button>

        <a
          href="{% url 'productos:admin_productos_lista' %}"
          class="px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all font-medium text-center flex items-center justify-center"
        >
          Cancelar
        </a>
      </div>
    </div>
  </div>

  <!-- Espaciador para compensar botones sticky -->
  <div class="h-20 md:h-24"></div>
</form>

{% endblock %} {% block extra_js %}
<script>
  // Preview de imagen
  function previewImagen(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const container = document.getElementById("preview-container");
        container.innerHTML = `
        <img src="${e.target.result}" class="max-w-full max-h-64 mx-auto rounded-lg shadow-lg">
        <p class="text-sm text-gray-600 mt-3">${file.name}</p>
      `;
      };
      reader.readAsDataURL(file);
    }
  }

  // Crear producto
  document
    .getElementById("producto-form")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      try {
        const response = await fetch(
          '{% url "productos:admin_producto_crear" %}',
          {
            method: "POST",
            headers: {
              "X-CSRFToken": csrftoken,
            },
            body: formData,
          }
        );

        const data = await response.json();

        if (data.success) {
          showToast(data.message, "success");

          setTimeout(() => {
            if (data.redirect) {
              window.location.href = data.redirect;
            } else {
              window.location.href =
                '{% url "productos:admin_productos_lista" %}';
            }
          }, 1000);
        } else {
          showToast(data.message || "Error al crear el producto", "error");
        }
      } catch (error) {
        console.error("Error:", error);
        showToast("Error al crear el producto", "error");
      }
    });
</script>
{% endblock %}
